const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Modal-XRBcOLpl.js","assets/index-DFeNkfPn.js","assets/index-Cg_uHQuN.css"])))=>i.map(i=>d[i]);
import{r as l,S as q,i as H,j as e,k as V,l as B,m as U,f as X,h as Y,n as J,o as Q,p as W,q as Z,s as ee,b as se,d as ae,e as te,_ as ie}from"./index-DFeNkfPn.js";import{T}from"./Tabela-8j8lVRxt.js";import{F as le}from"./FavoriteButton-BDjxeFIS.js";const ce=l.lazy(()=>ie(()=>import("./Modal-XRBcOLpl.js"),__vite__mapDeps([0,1,2]))),K=[{co_acao:1,no_acao:"Visualizar"},{co_acao:2,no_acao:"Criar"},{co_acao:3,no_acao:"Editar"},{co_acao:4,no_acao:"Excluir"}],oe=[{co_perfil:1,no_perfil:"Administrador",ic_situacao_ativo:!0},{co_perfil:2,no_perfil:"Gestor",ic_situacao_ativo:!0},{co_perfil:3,no_perfil:"Desenvolvedor",ic_situacao_ativo:!0}],ne=[{co_perfil:1,co_funcionalidade:"admin.gestao-acessos",co_acao:1},{co_perfil:1,co_funcionalidade:"admin.gestao-acessos",co_acao:2}],re=f=>{var r;const n={};for(const{co_perfil:o,co_funcionalidade:d,co_acao:b}of f)n[o]??(n[o]={}),(r=n[o])[d]??(r[d]={}),n[o][d][b]=!0;return n};function pe(){const{sistemas:f,funcionalidades:n}=l.useMemo(()=>{const s=Object.values(q).map(({key:a,title:t})=>({key:a,title:t})),i=H.filter(a=>!!a.featureKey).map(a=>({key:a.featureKey,name:a.groupLabel?`${a.groupLabel} > ${a.label}`:a.label,desc:a.path||"",sistema:a.section}));return{sistemas:s,funcionalidades:i}},[]),[r,o]=l.useState(oe),[d,b]=l.useState(()=>re(ne)),[k,j]=l.useState(null),[g,C]=l.useState(""),[z,v]=l.useState(!1),[_,I]=l.useState(null),[m,N]=l.useState({}),[y,h]=l.useState(!1),[de,S]=l.useTransition(),[M,O]=l.useState(null),x=l.useMemo(()=>K.map(s=>s.co_acao),[]),u=1,A=[2,3,4],P=l.useCallback(s=>{I(s),N(d[s.co_perfil]||{}),v(!0),h(!1)},[d]),D=l.useCallback((s,i)=>{S(()=>{N(a=>{var p;const t={...a};t[s]={...t[s]};const c=!!t[s][i];return i===u&&c?delete t[s]:(t[s][i]=!c,!t[s][u]&&A.includes(i)&&(t[s][u]=!0),t[s][u]||delete t[s]),(p=t[s])!=null&&p[u]||delete t[s],t}),h(!0)})},[]),L=l.useCallback((s,i)=>{var a;return!!((a=m[s])!=null&&a[i])},[m]),F=l.useCallback(s=>x.every(i=>{var a;return(a=m[s])==null?void 0:a[i]}),[m,x]),E=l.useCallback(s=>{S(()=>{N(i=>{const a={...i};return x.every(c=>{var p;return(p=i[s])==null?void 0:p[c]})?delete a[s]:(a[s]={},x.forEach(c=>a[s][c]=!0)),a}),h(!0)})},[x]),$=l.useMemo(()=>Object.values(m).reduce((s,i)=>s+Object.values(i).filter(Boolean).length,0),[m]),w=l.memo(({name:s,desc:i,allChecked:a,onToggleAll:t})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{className:"btn btn-ghost btn-sm p-1",onClick:c=>{c.stopPropagation(),t()},children:a?e.jsx(V,{className:"text-primary text-xl"}):e.jsx(B,{className:"text-base-content text-xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s}),i&&e.jsx("div",{className:"text-xs mt-1",children:i})]})]}),(s,i)=>s.allChecked===i.allChecked),R=l.memo(({funcKey:s,acaoKey:i,checked:a,onToggle:t})=>e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-primary",checked:a,onChange:c=>{c.stopPropagation(),t(s,i)}})}),(s,i)=>s.checked===i.checked),G=l.useMemo(()=>[{accessorKey:"co_perfil",header:()=>e.jsx("div",{className:"w-full text-center",children:"ID"}),cell:({getValue:s})=>e.jsx("div",{className:"text-center",children:s()}),size:60},{accessorKey:"no_perfil",header:"Nome",cell:({row:s})=>{const i=s.original;return k===i.co_perfil?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{className:"input input-sm text-md mr-1.5",value:g,onChange:a=>C(a.target.value),autoFocus:!0}),e.jsx("button",{className:"btn btn-ghost btn-sm text-success p-2",onClick:()=>{o(a=>a.map(t=>t.co_perfil===i.co_perfil?{...t,no_perfil:g}:t)),j(null)},children:e.jsx(U,{className:"text-xl"})}),e.jsx("button",{className:"btn btn-ghost btn-sm text-error p-2",onClick:()=>j(null),children:e.jsx(X,{className:"text-xl"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-md",children:i.no_perfil}),e.jsx("button",{className:"btn btn-ghost btn-sm text-primary p-2 tooltip tooltip-right","data-tip":"Editar Perfil",onClick:()=>{j(i.co_perfil),C(i.no_perfil)},children:e.jsx(Y,{className:"text-xl"})})]})}},{accessorKey:"ic_situacao_ativo",header:()=>e.jsx("div",{className:"w-full text-center",children:"Status"}),cell:({row:s})=>e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{className:`badge badge-${s.original.ic_situacao_ativo?"success":"error"}`,children:s.original.ic_situacao_ativo?"Habilitado":"Desabilitado"}),e.jsx("button",{className:"btn btn-ghost btn-sm text-primary p-2 tooltip tooltip-right","data-tip":s.original.ic_situacao_ativo?"Desabilitar":"Habilitar",onClick:()=>o(i=>i.map(a=>a.co_perfil===s.original.co_perfil?{...a,ic_situacao_ativo:!a.ic_situacao_ativo}:a)),children:s.original.ic_situacao_ativo?e.jsx(J,{className:"text-xl"}):e.jsx(Q,{className:"text-xl"})})]}),size:100},{accessorKey:"acoes",header:()=>e.jsx("div",{className:"w-full text-center",children:"Ações"}),cell:({row:s})=>e.jsxs("div",{className:"flex space-x-1 justify-center",children:[e.jsx("button",{className:"btn btn-ghost btn-sm text-primary p-2",onClick:()=>P(s.original),children:e.jsx(W,{className:"text-xl"})}),e.jsx("button",{className:"btn btn-ghost btn-sm text-error p-2",onClick:()=>o(i=>i.filter(a=>a.co_perfil!==s.original.co_perfil)),children:e.jsx(Z,{className:"text-xl"})})]}),size:100}],[k,g,P]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"flex text-3xl font-bold text-base-content",children:["Gestão de Perfis"," ",e.jsx(le,{tela:{nome:"Perfis",url:"/admin/perfis"}})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>o(s=>[{co_perfil:Date.now(),no_perfil:"Novo",ic_situacao_ativo:!0},...s]),children:[e.jsx(ee,{})," Novo"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"stats shadow bg-base-200",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-figure text-primary",children:e.jsx(se,{className:"text-3xl"})}),e.jsx("div",{className:"stat-title",children:"Total de Perfis"}),e.jsx("div",{className:"stat-value",children:r.length})]})}),e.jsx("div",{className:"stats shadow bg-base-200",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-figure text-primary",children:e.jsx(ae,{className:"text-3xl"})}),e.jsx("div",{className:"stat-title",children:"Habilitados"}),e.jsx("div",{className:"stat-value",children:r.filter(s=>s.ic_situacao_ativo).length})]})}),e.jsx("div",{className:"stats shadow bg-base-200",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-figure text-primary",children:e.jsx(te,{className:"text-3xl"})}),e.jsx("div",{className:"stat-title",children:"Desabilitados"}),e.jsx("div",{className:"stat-value",children:r.filter(s=>!s.ic_situacao_ativo).length})]})})]}),e.jsx(T,{data:r,columns:G,exportFileName:"perfis"}),z&&_&&e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Carregando..."}),children:e.jsxs(ce,{isOpen:!0,onClose:()=>v(!1),title:`Permissões: ${_.no_perfil}`,size:"6xl",children:[e.jsx("div",{className:"space-y-2 max-h-[70vh] overflow-auto",children:f.map(s=>{const i=n.filter(t=>t.sistema===s.key);if(!i.length)return null;const a=M===s.key;return e.jsxs("div",{className:"collapse collapse-arrow border border-base-300 bg-base-100",children:[e.jsx("input",{type:"checkbox",name:"collapse-group",checked:a,onChange:()=>O(a?null:s.key)}),e.jsxs("div",{className:"collapse-title font-medium flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.every(t=>F(t.key)),onChange:()=>i.forEach(t=>E(t.key)),onClick:t=>t.stopPropagation(),className:"z-2"}),s.title," (",i.length,")"]}),e.jsx("div",{className:"collapse-content",children:e.jsx(T,{data:i,columns:[{accessorKey:"name",header:"Funcionalidade",cell:({row:t})=>e.jsx(w,{name:t.original.name,desc:t.original.desc,allChecked:F(t.original.key),onToggleAll:()=>E(t.original.key)}),size:300},...K.map(t=>({id:`a${t.co_acao}`,header:t.no_acao,cell:({row:c})=>e.jsx(R,{funcKey:c.original.key,acaoKey:t.co_acao,checked:L(c.original.key,t.co_acao),onToggle:D}),size:80}))],globalFilter:!1,pagination:!1,enableExport:!1,disableSorting:!0})})]},s.key)})}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-base-200 mt-6",children:[e.jsxs("div",{children:[e.jsxs("span",{children:["Selecionadas: ",$]}),e.jsx("span",{className:"ml-4",children:y?"Não salvas":"Salvas"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:`btn ${y?"btn-primary":"btn-disabled"}`,onClick:()=>{b(s=>({...s,[_.co_perfil]:m})),h(!1)},disabled:!y,children:"Salvar"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Fechar"})]})]})]})})]})}export{pe as default};
